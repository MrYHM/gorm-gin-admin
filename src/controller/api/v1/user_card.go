package v1

import (
	"github.com/gin-gonic/gin"
	"github.com/olongfen/contrib/session"
	"github.com/olongfen/gorm-gin-admin/src/pkg/app"
	"github.com/olongfen/gorm-gin-admin/src/pkg/codes"
	"github.com/olongfen/gorm-gin-admin/src/service"
	"github.com/olongfen/gorm-gin-admin/src/utils"
)

// Verified 用户实名认证
// @tags 用户
// @Summary 用户实名认证
// @Produce json
// @Param form body utils.FormIDCard true "实名认证Form"
// @Success 200 {object} app.Response
// @Failure 500 {object} app.Response
// @router /api/v1/user/verified [post]
func Verified(c *gin.Context) {
	var (
		s    *session.Session
		form = new(utils.FormIDCard)
		err  error
		code = codes.CodeProcessingFailed
	)
	defer func() {
		if err != nil {
			app.NewGinResponse(c).Fail(code, err.Error()).Response()
		}
	}()
	if s, code, err = GetSession(c); err != nil {
		return
	}
	if err = c.ShouldBind(form); err != nil {
		code = codes.CodeParamInvalid
		return
	}
	if _d, _err := service.AddIDCard(s.UID, form); _err != nil {
		err = _err
		return
	} else {
		app.NewGinResponse(c).Success(_d).Response()
	}
}
